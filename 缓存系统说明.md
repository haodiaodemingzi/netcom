# ç¼“å­˜ç³»ç»Ÿè¯´æ˜

## ğŸ“¦ ç³»ç»Ÿæ¶æ„

### ç¼“å­˜æµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ APIå±‚ â†’ CacheManageræ£€æŸ¥ â†’ å‘½ä¸­è¿”å›
                              â†“ æœªå‘½ä¸­
                            çˆ¬è™«è·å– â†’ ä¿å­˜ç¼“å­˜ â†’ è¿”å›æ•°æ®
```

---

## ğŸ¯ ç¼“å­˜ç­–ç•¥

### ç¼“å­˜æ—¶é—´é…ç½®

| æ•°æ®ç±»å‹ | ç¼“å­˜æ—¶é—´ | è¯´æ˜ |
|---------|---------|------|
| çƒ­é—¨æ¼«ç”» | 5åˆ†é’Ÿ | æ›´æ–°é¢‘ç¹ |
| æœ€æ–°æ¼«ç”» | 5åˆ†é’Ÿ | æ›´æ–°é¢‘ç¹ |
| åˆ†ç±»æ¼«ç”» | 5åˆ†é’Ÿ | æ›´æ–°é¢‘ç¹ |
| æœç´¢ç»“æœ | 10åˆ†é’Ÿ | ç›¸å¯¹ç¨³å®š |
| æ¼«ç”»è¯¦æƒ… | 30åˆ†é’Ÿ | ç›¸å¯¹å›ºå®š |
| ç« èŠ‚åˆ—è¡¨ | 30åˆ†é’Ÿ | åŸºæœ¬ä¸å˜ |
| ç« èŠ‚å›¾ç‰‡ | 1å°æ—¶ | å®Œå…¨ä¸å˜ |
| åˆ†ç±»åˆ—è¡¨ | 1å¤© | æå°‘å˜åŒ– |

### ç¼“å­˜é”®ç»“æ„
```javascript
@comic_cache_{type}_{params}

ä¾‹å¦‚:
@comic_cache_hot_{"type":"hot","page":1,"limit":20,"source":"xmanhua"}
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### è‡ªåŠ¨ç¼“å­˜ï¼ˆæ¨èï¼‰
```javascript
import { getHotComics } from './services/api';

// è‡ªåŠ¨ä½¿ç”¨ç¼“å­˜
const comics = await getHotComics(1, 20, 'xmanhua');
// ç¬¬ä¸€æ¬¡: ä»ç½‘ç»œè·å– + ä¿å­˜åˆ°ç¼“å­˜
// ç¬¬äºŒæ¬¡: ç›´æ¥ä»ç¼“å­˜è¿”å›ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
```

### æ‰‹åŠ¨ç¼“å­˜æ§åˆ¶
```javascript
import CacheManager from './services/cache/CacheManager';

// æ‰‹åŠ¨åŒ…è£…å‡½æ•°
const data = await CacheManager.wrap('detail', { comicId: '123' }, async () => {
  // è·å–æ•°æ®çš„å‡½æ•°
  return await fetchComicDetail('123');
});

// è·å–ç¼“å­˜
const cached = await CacheManager.get('detail', { comicId: '123' });

// è®¾ç½®ç¼“å­˜
await CacheManager.set('detail', { comicId: '123' }, data);

// åˆ é™¤ç¼“å­˜
await CacheManager.remove('detail', { comicId: '123' });
```

---

## ğŸ”§ ç¼“å­˜ç®¡ç†

### åœ¨è®¾ç½®é¡µé¢

1. **æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡**
   - ç¼“å­˜é¡¹æ•°: æ˜¾ç¤ºæ´»è·ƒç¼“å­˜æ•°é‡
   - è¿‡æœŸç¼“å­˜: æ˜¾ç¤ºå·²è¿‡æœŸä½†æœªæ¸…é™¤çš„æ•°é‡
   - ç¼“å­˜å¤§å°: æ˜¾ç¤ºå ç”¨å­˜å‚¨ç©ºé—´

2. **æ¸…é™¤è¿‡æœŸç¼“å­˜**
   - åªåˆ é™¤å·²è¿‡æœŸçš„ç¼“å­˜
   - ä¿ç•™æœ‰æ•ˆç¼“å­˜
   - é‡Šæ”¾éƒ¨åˆ†å­˜å‚¨ç©ºé—´

3. **æ¸…é™¤å…¨éƒ¨ç¼“å­˜**
   - åˆ é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®
   - ä¸‹æ¬¡è¯·æ±‚é‡æ–°è·å–
   - å®Œå…¨é‡Šæ”¾å­˜å‚¨ç©ºé—´

### ç¼–ç¨‹æ–¹å¼

```javascript
import CacheManager from './services/cache/CacheManager';

// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
await CacheManager.clearAll();

// æ¸…é™¤è¿‡æœŸç¼“å­˜
await CacheManager.clearExpired();

// è·å–ç¼“å­˜ç»Ÿè®¡
const stats = await CacheManager.getStats();
console.log(stats);
// {
//   total: 15,        // æ€»ç¼“å­˜æ•°
//   expired: 3,       // è¿‡æœŸæ•°
//   active: 12,       // æ´»è·ƒæ•°
//   size: 524288,     // å­—èŠ‚æ•°
//   sizeKB: '512.00', // KB
//   sizeMB: '0.50'    // MB
// }
```

---

## ğŸ“Š æ€§èƒ½æå‡

### å¯¹æ¯”æ•°æ®

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| é¦–é¡µåŠ è½½ | 2-3ç§’ | 0.1ç§’ | **20-30å€** |
| æ¼«ç”»è¯¦æƒ… | 1-2ç§’ | 0.05ç§’ | **20-40å€** |
| ç« èŠ‚åˆ—è¡¨ | 1-2ç§’ | 0.05ç§’ | **20-40å€** |
| æœç´¢ç»“æœ | 2-4ç§’ | 0.1ç§’ | **20-40å€** |

### ç½‘ç»œæµé‡èŠ‚çœ
- ç¬¬ä¸€æ¬¡è®¿é—®: æ­£å¸¸ç½‘ç»œè¯·æ±‚
- ç¼“å­˜æœŸå†…: **0 KB** ç½‘ç»œæµé‡
- å¹³å‡èŠ‚çœ: **80-90%** ç½‘ç»œæµé‡

---

## ğŸ¨ ç¼“å­˜æ—¥å¿—

### æ—¥å¿—æ ¼å¼
```javascript
// ç¼“å­˜å‘½ä¸­
[Cache] HIT - hot: {page: 1, limit: 20, source: 'xmanhua'}

// ç¼“å­˜æœªå‘½ä¸­
[Cache] MISS - detail: {comicId: '123xm', source: 'xmanhua'}

// ç¼“å­˜è¿‡æœŸ
[Cache] EXPIRED - hot: {page: 1, limit: 20}

// è®¾ç½®ç¼“å­˜
[Cache] SET - hot: {page: 1} (300s)

// åˆ é™¤ç¼“å­˜
[Cache] REMOVE - hot: {page: 1}

// æ¸…é™¤å…¨éƒ¨
[Cache] CLEAR ALL - æ¸…é™¤äº† 15 ä¸ªç¼“å­˜

// æ¸…é™¤è¿‡æœŸ
[Cache] CLEAR EXPIRED - æ¸…é™¤äº† 3 ä¸ªè¿‡æœŸç¼“å­˜
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç¼“å­˜æ›´æ–°
- âŒ ç¼“å­˜ä¸ä¼šè‡ªåŠ¨æ›´æ–°å†…å®¹
- âœ… ç­‰å¾…è¿‡æœŸåè‡ªåŠ¨é‡æ–°è·å–
- âœ… æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜å¼ºåˆ¶æ›´æ–°

### å­˜å‚¨é™åˆ¶
- AsyncStorage é»˜è®¤é™åˆ¶: **6MB**
- å»ºè®®å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- ç¼“å­˜æ»¡æ—¶è‡ªåŠ¨è¦†ç›–

### æ•°æ®ä¸€è‡´æ€§
- ç¼“å­˜æ•°æ®å¯èƒ½ä¸æœåŠ¡å™¨ä¸ä¸€è‡´
- æ•æ„Ÿæ•°æ®ä¸å»ºè®®ç¼“å­˜
- ç”¨æˆ·æ“ä½œåå»ºè®®æ¸…é™¤ç›¸å…³ç¼“å­˜

---

## ğŸ”„ ç¼“å­˜å¤±æ•ˆåœºæ™¯

### è‡ªåŠ¨å¤±æ•ˆ
1. **è¶…è¿‡è¿‡æœŸæ—¶é—´** - è‡ªåŠ¨æ ‡è®°ä¸ºè¿‡æœŸ
2. **APPé‡å¯** - ç¼“å­˜ä¿ç•™ï¼Œåªè¦æœªè¿‡æœŸ
3. **æ•°æ®æºåˆ‡æ¢** - ä¸åŒæ•°æ®æºç¼“å­˜åˆ†ç¦»

### æ‰‹åŠ¨å¤±æ•ˆ
1. **ç”¨æˆ·æ¸…é™¤ç¼“å­˜** - è®¾ç½®é¡µé¢æ“ä½œ
2. **ä»£ç è°ƒç”¨æ¸…é™¤** - ç¨‹åºæ§åˆ¶
3. **å­˜å‚¨ç©ºé—´ä¸è¶³** - ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†

---

## ğŸš€ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ç¼“å­˜æ—¶é—´
```javascript
// ä¿®æ”¹ CacheManager.js ä¸­çš„ cacheDuration
this.cacheDuration = {
  hot: 600,     // æ”¹ä¸º10åˆ†é’Ÿ
  detail: 3600, // æ”¹ä¸º1å°æ—¶
  // ...
};
```

### ç¦ç”¨ç‰¹å®šç±»å‹ç¼“å­˜
```javascript
// åœ¨çˆ¬è™«ç±»ä¸­
this.enableCache = false; // ç¦ç”¨ç¼“å­˜

// æˆ–è€…åœ¨APIå±‚è·³è¿‡ç¼“å­˜
const data = await scraper.getHotComics(); // ä¸ç»è¿‡ cache.wrap
```

### é¢„åŠ è½½ç¼“å­˜
```javascript
// åå°é¢„åŠ è½½çƒ­é—¨æ•°æ®
async function preloadCache() {
  await getHotComics(1, 20, 'xmanhua');
  await getLatestComics(1, 20, 'xmanhua');
  // ç¼“å­˜å·²å»ºç«‹ï¼Œç”¨æˆ·è®¿é—®æ—¶ç§’å¼€
}
```

---

## ğŸ“ˆ ç›‘æ§ä¸è°ƒè¯•

### æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡
```javascript
let hits = 0;
let misses = 0;

// åœ¨ CacheManager.get ä¸­ç»Ÿè®¡
if (cached) hits++;
else misses++;

console.log(`ç¼“å­˜å‘½ä¸­ç‡: ${(hits / (hits + misses) * 100).toFixed(2)}%`);
```

### è°ƒè¯•ç¼“å­˜é—®é¢˜
1. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿— `[Cache]`
2. æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
3. å°è¯•æ¸…é™¤ç¼“å­˜é‡è¯•
4. æ£€æŸ¥ç¼“å­˜é”®æ˜¯å¦æ­£ç¡®

---

## ğŸ‰ æ€»ç»“

### ä¼˜åŠ¿
- âœ… **å¤§å¹…æå‡é€Ÿåº¦** - 20-40å€æ€§èƒ½æå‡
- âœ… **èŠ‚çœæµé‡** - å‡å°‘80-90%ç½‘ç»œè¯·æ±‚
- âœ… **ç¦»çº¿å¯ç”¨** - ç¼“å­˜æœŸå†…æ— éœ€ç½‘ç»œ
- âœ… **ç”¨æˆ·ä½“éªŒ** - å³æ—¶åŠ è½½ï¼Œæµç•…ä½“éªŒ

### æœ€ä½³å®è·µ
1. å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
2. ç›‘æ§ç¼“å­˜å¤§å°
3. åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
4. å…³é”®æ“ä½œåæ¸…é™¤ç¼“å­˜

äº«å—æé€Ÿä½“éªŒï¼ğŸš€
