# 前端集成 xmanhua 数据源完成

## 完成内容

### 1. 数据源管理
- **默认数据源**: 修改为 `guoman8`
- **数据源切换**: 在"我的"页面的设置区域添加数据源选择功能
- **持久化存储**: 使用 AsyncStorage 保存用户选择的数据源

### 2. 修改的文件

#### `services/storage.js`
- 修改 `getCurrentSource()` 默认返回值从 `mock` 改为 `guoman8`

#### `app/(tabs)/profile.js`
- 添加数据源选择功能
- 从后端 API 获取可用数据源列表
- 显示当前选择的数据源
- 点击可切换数据源

#### `app/(tabs)/index.js`
- 首页默认数据源改为 `guoman8`
- 已支持数据源切换(原有功能)

#### `app/(tabs)/search.js`
- 添加数据源状态管理
- 搜索时传入当前选择的数据源参数

#### `app/comic/[id].js`
- 添加数据源状态管理
- 获取漫画详情和章节列表时传入当前数据源参数

#### `app/reader/[chapterId].js`
- 添加数据源状态管理
- 获取章节图片时传入当前数据源参数

## 实现原理

### 按需加载机制
所有页面都采用**实时请求**的方式：

1. **首页浏览**: 
   - 用户切换分类时，实时请求对应分类的漫画列表
   - 支持分页加载，滚动到底部时加载更多

2. **搜索功能**:
   - 用户输入关键词搜索时，实时调用搜索 API
   - 不会预加载或缓存搜索结果

3. **漫画详情**:
   - 用户点击某个漫画时，实时请求该漫画的详情和章节列表
   - 不会一次性加载所有漫画的详情

4. **阅读章节**:
   - 用户点击某个章节时，实时请求该章节的图片列表
   - 不会预加载其他章节的图片

### 数据源切换流程

1. 用户进入"我的"页面
2. 点击"数据源"选项
3. 弹出数据源选择对话框
4. 选择新的数据源(guoman8 或 xmanhua)
5. 保存到本地存储
6. 下次请求时自动使用新的数据源

## 使用说明

### 切换数据源
1. 打开 App
2. 点击底部导航栏的"我的"
3. 在"设置"区域找到"数据源"选项
4. 点击后选择想要使用的数据源
5. 确认后会显示切换成功提示

### 数据源说明
- **guoman8**: 国漫8采集源，默认数据源
- **xmanhua**: X漫画采集源，新增数据源

## 技术特点

1. **实时请求**: 所有数据都是按需实时请求，不会一次性爬取所有数据
2. **性能优化**: 使用分页加载，避免一次性加载大量数据
3. **用户体验**: 数据源切换即时生效，无需重启 App
4. **代码复用**: API 层已经支持数据源参数，前端只需传入即可

## 后续优化建议

1. **缓存机制**: 可以添加本地缓存，减少重复请求
2. **离线下载**: 支持下载漫画到本地，离线阅读
3. **数据源聚合**: 同时搜索多个数据源，聚合显示结果
4. **智能推荐**: 根据用户阅读历史推荐相似漫画
