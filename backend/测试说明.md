# 测试脚本使用说明

## 测试脚本列表

### 1. test_guoman8.py - 国漫8详细测试

测试国漫8采集源的所有功能，包括：
- ✅ 获取分类列表
- ✅ 获取分类漫画(支持分页)
- ✅ 获取热门漫画
- ✅ 搜索漫画
- ✅ 获取漫画详情
- ✅ 获取章节列表
- ✅ 获取章节图片URL

**使用方法**:
```bash
cd backend
python test_guoman8.py
```

**输出示例**:
```
============================================================
  测试1: 获取分类列表
============================================================

分类总数: 15
分类列表:
  - ID: 1, 名称: 热血
  - ID: 2, 名称: 冒险
  ...
```

### 2. test_all_sources.py - 所有数据源快速测试

快速测试所有已启用的数据源，验证基本功能是否正常。

**使用方法**:
```bash
cd backend
python test_all_sources.py
```

**输出示例**:
```
============================================================
  测试数据源: 国漫8 (guoman8)
============================================================

1. 测试获取分类...
   ✓ 分类数量: 15
   ✓ 示例: 热血

2. 测试获取热门漫画...
   ✓ 漫画数量: 3
   ✓ 示例: 腹腹教师
...
```

### 3. run_tests.bat - Windows批处理脚本

提供菜单式选择，方便运行测试。

**使用方法**:
```bash
cd backend
run_tests.bat
```

## 测试前准备

### 1. 安装依赖

```bash
cd backend
pip install -r requirements.txt
```

### 2. 确保网络连接

测试脚本会实际访问目标网站，需要网络连接。

## 测试结果说明

### 成功标志

- ✅ 绿色对勾表示测试通过
- 显示具体的数据数量和示例

### 失败情况

- ❌ 红色叉号表示测试失败
- 会显示错误信息和堆栈跟踪

### 常见问题

#### 1. 图片数量为0

**原因**: JavaScript解密逻辑可能需要优化

**解决方案**:
- 检查章节页面的HTML结构
- 优化 `_extract_images_from_js()` 方法
- 考虑使用 PyExecJS 执行JS代码

#### 2. 分类或漫画列表为空

**原因**: CSS选择器可能不匹配

**解决方案**:
- 访问目标网站检查HTML结构
- 更新CSS选择器
- 检查网站是否有反爬虫机制

#### 3. 请求超时或失败

**原因**: 网络问题或被网站拦截

**解决方案**:
- 检查网络连接
- 增加请求延迟
- 更换User-Agent
- 考虑使用代理

## 调试技巧

### 1. 查看详细日志

在测试脚本中已经包含了详细的输出，可以看到：
- 每个步骤的执行情况
- 返回的数据数量
- 示例数据内容

### 2. 单独测试某个功能

可以修改测试脚本，只运行特定的测试函数：

```python
# 只测试获取分类
if __name__ == "__main__":
    test_categories()
```

### 3. 添加更多调试信息

在爬虫类中添加打印语句：

```python
def get_categories(self):
    response = self._make_request(self.base_url)
    print(f"Response status: {response.status_code}")
    print(f"Response length: {len(response.text)}")
    # ...
```

## 性能测试

### 测试响应时间

可以添加时间统计：

```python
import time

start = time.time()
result = scraper.get_hot_comics()
end = time.time()
print(f"耗时: {end - start:.2f}秒")
```

### 测试并发

测试多个请求的性能：

```python
import concurrent.futures

def test_concurrent():
    scraper = Guoman8Scraper()
    with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:
        futures = [
            executor.submit(scraper.get_hot_comics, page=i) 
            for i in range(1, 6)
        ]
        results = [f.result() for f in futures]
```

## 持续集成

可以将测试脚本集成到CI/CD流程中：

```yaml
# .github/workflows/test.yml
name: Test Scrapers
on: [push]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: pip install -r backend/requirements.txt
      - name: Run tests
        run: python backend/test_all_sources.py
```

## 注意事项

1. **请求频率**: 不要过于频繁地测试，避免被目标网站封IP
2. **数据变化**: 网站结构可能会变化，需要定期更新选择器
3. **错误处理**: 测试脚本已包含异常捕获，但实际使用时需要更完善的错误处理
4. **合法性**: 确保爬取行为符合网站的使用条款和robots.txt规则
