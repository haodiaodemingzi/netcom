# 代理功能使用说明

## 功能概述

本系统已集成完整的SSR/Trojan代理管理功能，支持：
- ✅ 订阅地址解析（Trojan、Shadowsocks、ShadowsocksR、VMess）
- ✅ 节点管理和选择
- ✅ 代理转发API请求
- ✅ 前端可视化配置界面

## 架构说明

```
┌─────────────────┐
│  React Native   │
│   前端应用      │
└────────┬────────┘
         │ HTTP请求
         ▼
┌─────────────────┐
│  Flask后端      │
│  代理管理服务   │
└────────┬────────┘
         │ 通过本地代理客户端
         ▼
┌─────────────────┐
│  SSR/Trojan     │
│  节点服务器     │
└─────────────────┘
```

## 使用流程

### 1. 获取订阅地址

从你的代理服务商获取订阅链接，例如：
```
https://tvm.xa5z.org/xm6bh9/7653906740a573c922f118f6fd1a89d5
```

### 2. 在APP中配置

1. 打开"代理设置"界面
2. 输入订阅地址
3. 点击"更新订阅"
4. 选择一个节点
5. 启用代理

### 3. 后端API使用

后端已经集成代理管理API：

#### 更新订阅
```bash
POST /api/proxy/subscription
{
  "url": "https://your-subscription-url"
}
```

#### 获取节点列表
```bash
GET /api/proxy/nodes
```

#### 选择节点
```bash
POST /api/proxy/select
{
  "index": 0
}
```

#### 获取当前节点
```bash
GET /api/proxy/selected
```

## 代理客户端配置

**重要**: Python的requests库不能直接使用Trojan/SS/SSR协议，需要本地运行代理客户端。

### 方案1: 使用Clash（推荐）

1. 下载并安装 [Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg)

2. 导入订阅地址到Clash

3. 启用系统代理或配置HTTP/SOCKS5端口（默认7890）

4. 后端通过本地代理转发：

```python
# 在后端请求中使用
proxies = {
    'http': 'http://127.0.0.1:7890',
    'https': 'http://127.0.0.1:7890'
}
response = requests.get(url, proxies=proxies)
```

### 方案2: 使用V2Ray

1. 下载 [V2RayN](https://github.com/2dust/v2rayN)
2. 导入订阅
3. 配置本地端口（默认10808）
4. 后端使用SOCKS5代理

### 方案3: 移动端直接代理

在React Native中，可以使用系统代理设置：

```javascript
// Android需要在AndroidManifest.xml配置
// iOS会自动使用系统代理
```

## 配置示例

### config.py 代理配置

```python
PROXY_CONFIG = {
    'enabled': True,
    'host': '127.0.0.1',
    'port': 7890,
    'type': 'http'  # 或 'socks5'
}
```

### 使用代理的Scraper示例

```python
from services.proxy_manager import proxy_manager

class MyScr