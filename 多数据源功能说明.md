# 多数据源功能说明

## ✅ 已完成功能

### 后端实现

1. **配置文件** (`backend/config.py`)
   - 支持配置多个数据源
   - 可以启用/禁用数据源
   - 设置默认数据源

2. **爬虫基类** (`backend/services/base_scraper.py`)
   - 定义统一的爬虫接口
   - 所有数据源继承此基类

3. **多个数据源实现** (`backend/services/scraper.py`)
   - ✅ KomiicScraper (Komiic)
   - ✅ ManhuaguiScraper (漫画柜)
   - ✅ CopymangaScraper (拷贝漫画)
   - ✅ MockScraper (测试数据)

4. **爬虫工厂** (`backend/services/scraper_factory.py`)
   - 根据配置创建爬虫实例
   - 单例模式管理爬虫
   - 获取可用数据源列表

5. **API 接口更新**
   - 所有接口支持 `source` 参数
   - 新增 `/api/sources` 接口获取数据源列表

### 前端实现

1. **API 服务更新** (`services/api.js`)
   - 所有 API 方法支持 `source` 参数
   - 新增 `getAvailableSources()` 方法

2. **本地存储** (`services/storage.js`)
   - 保存当前选择的数据源
   - 读取用户选择的数据源

3. **首页数据源切换** (`app/(tabs)/index.js`)
   - 右上角显示当前数据源
   - 点击展开数据源菜单
   - 选择数据源后自动刷新数据
   - 保存用户选择

## 🎯 使用方法

### 后端配置

1. 打开 `backend/config.py`
2. 在 `COMIC_SOURCES` 中添加或修改数据源:

```python
COMIC_SOURCES = {
    'your_source': {
        'name': '你的数据源名称',
        'base_url': 'https://your-site.com',
        'enabled': True,
        'description': '数据源描述',
    },
}
```

3. 在 `backend/services/scraper.py` 中实现对应的爬虫类
4. 在 `backend/services/scraper_factory.py` 中注册

### 前端使用

1. 启动应用后,首页右上角会显示当前数据源
2. 点击数据源按钮,展开数据源列表
3. 选择想要的数据源
4. 数据会自动刷新

## 📁 新增文件

```
backend/
├── config.py                      # 数据源配置文件
├── services/
│   ├── base_scraper.py           # 爬虫基类
│   └── scraper_factory.py        # 爬虫工厂

docs/
└── 多数据源配置说明.md            # 详细配置文档
```

## 🔧 修改的文件

```
backend/
├── app.py                         # 添加 /api/sources 接口
├── routes/
│   ├── comic.py                  # 所有接口支持 source 参数
│   └── search.py                 # 搜索接口支持 source 参数
└── services/
    └── scraper.py                # 重构为多个爬虫类

frontend/
├── services/
│   ├── api.js                    # API 方法支持 source 参数
│   └── storage.js                # 添加数据源存储
└── app/(tabs)/
    └── index.js                  # 添加数据源切换 UI
```

## 🌟 特性

1. **灵活配置**: 在配置文件中管理所有数据源
2. **热切换**: 无需重启,直接切换数据源
3. **状态保存**: 记住用户选择的数据源
4. **扩展性强**: 轻松添加新数据源
5. **统一接口**: 所有数据源使用相同的接口

## 📝 API 示例

### 获取数据源列表

```bash
GET http://localhost:5000/api/sources
```

响应:
```json
{
  "mock": {
    "name": "测试数据",
    "description": "模拟测试数据源",
    "enabled": true
  },
  "komiic": {
    "name": "Komiic",
    "description": "Komiic 漫画源",
    "enabled": true
  }
}
```

### 使用指定数据源

```bash
GET http://localhost:5000/api/comics/hot?source=manhuagui&page=1
GET http://localhost:5000/api/comics/search?keyword=test&source=copymanga
```

## 🎨 UI 效果

首页右上角:
```
┌─────────────────────────────┐
│ 漫画阅读器    [测试数据 ▼]   │
├─────────────────────────────┤
│ ✓ 测试数据                   │
│   模拟测试数据源              │
├─────────────────────────────┤
│   Komiic                    │
│   Komiic 漫画源              │
├─────────────────────────────┤
│   漫画柜                     │
│   漫画柜数据源               │
└─────────────────────────────┘
```

## 🚀 测试

1. 启动后端: `cd backend && python app.py`
2. 启动前端: `npm start`
3. 在首页点击右上角数据源按钮
4. 选择不同的数据源查看效果

## 📚 详细文档

查看 `docs/多数据源配置说明.md` 了解:
- 如何添加新数据源
- 数据源架构说明
- API 接口详情
- 常见问题解答

## ✨ 总结

多数据源功能已完全实现,支持:
- ✅ 后端配置多个数据源
- ✅ 前端切换数据源
- ✅ 状态持久化
- ✅ 统一的接口设计
- ✅ 易于扩展

现在你可以在配置文件中添加任意数量的数据源,用户可以在前端自由切换!
